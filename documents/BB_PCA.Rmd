---
title: "BB_PCA"
output: html_notebook
---
Goal: Make a PCA Plot for brown bears. PCA data generated by tassel on the cluster with 3 PCs. We don't know how many PCs they did in the paper.

Set-up:
```{r}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
```



Read in Data and Clean
```{r}
bbPCread <- read.table("C:/Users/ebola/ECL243/data/PCApbsubfullBrownbear1.txt", comment.char = "", fill=T, sep="\t") #leaving head=true confused it, so I just read it in without, need to get rid of two rows
colnames(bbPCread) <- c("taxa", "PC1", "PC2", "PC3") #add header row

#remove extra rows
head(bbPCread)
bbPCread1 <- bbPCread[-1,] #remove row 1
bbPCread2 <- bbPCread1[-1,] #remove row 2
bbPCA <- bbPCread2[-1,] #remove row 3
```

Nead to separate out the locations of the bears
```{r}
bbPCA$location <- "ABC"
bbPCA$location[7] <- "GP01"
bbPCA$location[8] <- "SJS01"
bbPCA$location[9] <- "OFS01"
bbPCA$location[10] <- "RF01"

```

Plot with the locations as separate symbols, then save the plot
```{r}
bbPCAplot<- ggplot (data = bbPCA, aes(PC1, PC2)) + #this means we are plotting the PC1 & PC2
  geom_point(aes(shape = location)) + #telling it that I want the shapes to change by location
  scale_shape_manual(values = c(3,4,8,15,1)) + #telling it that I want crosses and pluses
  theme(legend.position = "bottom" ) + #legend
  theme_classic() + #white background
  ggtitle("Brown Bear High-Coverage PCA") #title
bbPCAplot

#ggsave("bbPCAplot.pdf")
```

Try this again with a log scale to see if it looks better. 
```{r}
#bbPCAplotlog<- ggplot (data = bbPCA, aes(PC1, PC2)) + #this means we are plotting the PC1 & PC2
 # geom_point(aes(shape = location)) + #telling it that I want the shapes to change by location
  #scale_shape_manual(values = c(3,4,8,15,1)) + #telling it that I want crosses and pluses and other things
  #scale_x_continuous(trans = "log") + that did not work
  #scale_x_log10() +
  #scale_y_log10() +
  #theme(legend.position = "bottom" ) + #legend
  #theme_classic() + #white background
  #ggtitle("Brown Bear High-Coverage PCA (log scale)") #title
#bbPCAplotlog this returns the error "Error in Math.factor(x, base) : 'log' not meaningful for factors"

#let's turn the data into numeric for this
str(bbPCA)
bbPCAnumeric <- bbPCA
bbPCAnumeric$PC1 <- as.numeric(as.character(bbPCAnumeric$PC1))
bbPCAnumeric$PC2 <- as.numeric(as.character(bbPCAnumeric$PC2))
str(bbPCAnumeric) #now PC1 is numeric for this data

#now try to plot again with data as numeric
#bbPCAplotlog<- ggplot (data = bbPCAnumeric, aes(PC1, PC2), scale ="globalminmax") + #this means we are plotting the PC1 & PC2
 # geom_point(aes(shape = location)) + #telling it that I want the shapes to change by location
  #scale_shape_manual(values = c(3,4,8,15,1)) + #telling it that I want crosses and pluses and other things
  #scale_x_continuous(trans = "log10", limits = NA,NA) + 
  #scale_y_continuous(trans = "log10", limits = NA,NA) + 
  #scale_x_log10(limits = c(NA,NA)) + #it doesn't like this style, need to put in limits to get it all on the chart PC1 goes -710 - 363, PC2 goes -768 - 220
  #scale_y_log10(limits = c(NA,NA)) +
  #theme(legend.position = "bottom" ) + #legend
  #theme_classic() + #white background
  #ggtitle("Brown Bear High-Coverage PCA (log scale)")
#bbPCAplotlog #this erases 3 rows of data, the 3 last entries, which happen to be negative on the x axis...

#try one with log scales
#bbPCAplotlog<- ggplot (data = bbPCAnumeric, aes(PC1, PC2), scale ="globalminmax") + #this means we are plotting the PC1 & PC2
 # geom_point(aes(shape = location)) + #telling it that I want the shapes to change by location
  #scale_shape_manual(values = c(3,4,8,15,1)) + #telling it that I want crosses and pluses and other things
  #scale_x_continuous(trans = "log10", limits = NA,NA) + 
  #scale_y_continuous(trans = "log10", limits = NA,NA) + 
  #scale_x_log10(limits = c(NA,NA)) + #it doesn't like this style, need to put in limits to get it all on the chart PC1 goes -710 - 363, PC2 goes -768 - 220
  #scale_y_log10(limits = c(NA,NA)) +
  #theme(legend.position = "bottom" ) + #legend
  #theme_classic() + #white background
  #ggtitle("Brown Bear High-Coverage PCA (log scale)")
#bbPCAplotlog #this erases 3 rows of data, the 3 last entries, which happen to be negative on the x axis...


#another try with log scales
bbPCAplotlog1<- ggplot (data = bbPCAnumeric, aes(PC1, PC2), scale ="globalminmax") + #this means we are plotting the PC1 & PC2
  geom_point(aes(shape = location)) + #telling it that I want the shapes to change by location
  scale_shape_manual(values = c(3,4,8,15,1)) + #telling it that I want crosses and pluses and other things
  #scale_x_continuous(trans = "log10", limits = NA,NA) + 
  #scale_y_continuous(trans = "log10", limits = NA,NA) + 
  #scale_x_log10(limits = c(NA,NA)) + #it doesn't like this style, need to put in limits to get it all on the chart PC1 goes -710 - 363, PC2 goes -768 - 220
  scale_y_log10() +
  theme(legend.position = "bottom" ) + #legend
  theme_classic() + #white background
  ggtitle("Brown Bear High-Coverage PCA (y-axis log scale)")
bbPCAplotlog1 #this is pretty good, although it removed 2 data points, including GP01
#ggsave(bbPCAplotlog1) #Error: `device` must be NULL, a string or a function. won't let me save. work-around: just make a snip of the image


#the PCA they made looked diagonally flipped from mine, so I want to try making those last 3 positive for PC1 and see what it looks like
bbPCAposnumeric <- bbPCAnumeric

bbPCAposnumeric$PC1[8] <- 687.7262
bbPCAposnumeric$PC1[9] <- 709.7383
bbPCAposAnumeric$PC1[10] <- 611.9418 #this one refuses to become positive

#now plot as log
#bbPCAplotlog2<- ggplot (data = bbPCAposnumeric, aes(PC1, PC2)) + #this means we are plotting the PC1 & PC2
 #geom_point(aes(shape = location)) + #telling it that I want the shapes to change by location
  #scale_shape_manual(values = c(3,4,8,15,1)) + #telling it that I want crosses, pluses, other stuff
  #scale_x_continuous(trans = "log10", limits = NA,NA) + #use NA limits to tell it use whatever the data gives you
  #scale_y_continuous(trans = "log10", limits = NA,NA) + 
  #scale_x_log10()) + 
  #scale_y_log10() +
  #theme(legend.position = "bottom" ) + #legend
  #theme_classic() + #white background
  #ggtitle("Brown Bear High-Coverage PCA (y-xis log scale, data altered)")
#bbPCAplotlog2 #just looks weird 




```

None of that works quite right, it cuts off part of the x-axis or doesn't plot all the animals, but I think they must have some log stuff in their custom script.

